<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDB Manager - Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            background-color: #007acc;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #005a9e;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        input, textarea {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .output {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
        }
        .item-id {
            font-weight: bold;
            color: #007acc;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è IDB Manager - Demostraci√≥n Interactiva</h1>
        
        <div class="section">
            <h2>üìä Estado de la Base de Datos</h2>
            <div class="controls">
                <button onclick="initDatabase()">Inicializar DB</button>
                <button onclick="getStats()">Obtener Estad√≠sticas</button>
                <button onclick="clearDatabase()">Limpiar DB</button>
            </div>
            <div id="status-output" class="output">Presiona "Inicializar DB" para comenzar...</div>
        </div>

        <div class="section">
            <h2>‚ûï Agregar Datos</h2>
            <div class="controls">
                <input type="text" id="name-input" placeholder="Nombre" value="Juan P√©rez">
                <input type="email" id="email-input" placeholder="Email" value="juan@ejemplo.com">
                <input type="number" id="age-input" placeholder="Edad" value="30">
                <button onclick="addItem()">Agregar Elemento</button>
                <button onclick="addMultipleItems()">Agregar M√∫ltiples</button>
            </div>
            <div id="add-output" class="output"></div>
        </div>

        <div class="section">
            <h2>üîç Buscar y Filtrar</h2>
            <div class="controls">
                <input type="text" id="search-input" placeholder="Buscar por nombre o email">
                <button onclick="searchItems()">Buscar</button>
                <button onclick="getAllItems()">Obtener Todos</button>
                <input type="number" id="limit-input" placeholder="L√≠mite" value="5">
                <button onclick="getPaginated()">Paginado</button>
            </div>
            <div id="search-output" class="output"></div>
        </div>

        <div class="section">
            <h2>‚úèÔ∏è Actualizar Datos</h2>
            <div class="controls">
                <input type="number" id="update-id" placeholder="ID del elemento">
                <input type="text" id="update-name" placeholder="Nuevo nombre">
                <input type="email" id="update-email" placeholder="Nuevo email">
                <button onclick="updateItem()">Actualizar</button>
            </div>
            <div id="update-output" class="output"></div>
        </div>

        <div class="section">
            <h2>üóëÔ∏è Eliminar Datos</h2>
            <div class="controls">
                <input type="number" id="delete-id" placeholder="ID del elemento">
                <button onclick="deleteItem()">Eliminar por ID</button>
                <button onclick="deleteByEmail()">Eliminar por Email</button>
                <input type="email" id="delete-email" placeholder="Email a eliminar">
            </div>
            <div id="delete-output" class="output"></div>
        </div>

        <div class="section">
            <h2>üì§ Importar/Exportar</h2>
            <div class="controls">
                <button onclick="exportData()">Exportar JSON</button>
                <button onclick="exportCSV()">Exportar CSV</button>
                <input type="file" id="import-file" accept=".json">
                <button onclick="importData()">Importar JSON</button>
            </div>
            <div id="export-output" class="output"></div>
        </div>
    </div>

    <!-- Cargar la librer√≠a desde CDN local -->
    <script src="../../dist/cdn/idb-manager.js"></script>
    
    <script>
        // Variables globales
        let dbManager;
        let isInitialized = false;

        // Configuraci√≥n de la base de datos
        const dbConfig = {
            name: 'DemoDatabase',
            version: 1,
            store: 'users'
        };

        // Opciones del manager
        const managerOptions = {
            storeName: 'users',
            enableEvents: true,
            autoInit: false,
            debug: true
        };

        // Funci√≥n para mostrar mensajes en la salida
        function showOutput(elementId, message, isError = false) {
            const output = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const status = isError ? 'error' : 'success';
            output.innerHTML += `<div class="status ${status}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        // Inicializar la base de datos
        async function initDatabase() {
            try {
                showOutput('status-output', 'Inicializando base de datos...');
                
                // Crear el manager
                dbManager = IDBManager.createManager(dbConfig, managerOptions);
                
                // Configurar eventos
                dbManager.on('create', (data) => {
                    showOutput('status-output', `‚úÖ Elemento creado: ID ${data.id}`);
                });
                
                dbManager.on('update', (data) => {
                    showOutput('status-output', `üîÑ Elemento actualizado: ID ${data.id}`);
                });
                
                dbManager.on('delete', (data) => {
                    showOutput('status-output', `üóëÔ∏è Elemento eliminado: ID ${data.id}`);
                });
                
                // Abrir la base de datos
                await dbManager.openDatabase();
                isInitialized = true;
                
                showOutput('status-output', '‚úÖ Base de datos inicializada correctamente');
                
            } catch (error) {
                showOutput('status-output', `‚ùå Error al inicializar: ${error.message}`, true);
            }
        }

        // Obtener estad√≠sticas
        async function getStats() {
            if (!isInitialized) {
                showOutput('status-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            try {
                const count = await dbManager.count();
                showOutput('status-output', `üìä Total de elementos en la DB: ${count}`);
            } catch (error) {
                showOutput('status-output', `‚ùå Error al obtener estad√≠sticas: ${error.message}`, true);
            }
        }

        // Limpiar base de datos
        async function clearDatabase() {
            if (!isInitialized) {
                showOutput('status-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            try {
                await dbManager.clearDatabase();
                showOutput('status-output', 'üßπ Base de datos limpiada');
            } catch (error) {
                showOutput('status-output', `‚ùå Error al limpiar: ${error.message}`, true);
            }
        }

        // Agregar un elemento
        async function addItem() {
            if (!isInitialized) {
                showOutput('add-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const name = document.getElementById('name-input').value;
            const email = document.getElementById('email-input').value;
            const age = parseInt(document.getElementById('age-input').value);
            
            if (!name || !email || !age) {
                showOutput('add-output', '‚ö†Ô∏è Completa todos los campos', true);
                return;
            }
            
            try {
                const item = { name, email, age, createdAt: new Date().toISOString() };
                const result = await dbManager.create(item);
                showOutput('add-output', `‚úÖ Elemento agregado con ID: ${result.id}`);
                
                // Limpiar campos
                document.getElementById('name-input').value = '';
                document.getElementById('email-input').value = '';
                document.getElementById('age-input').value = '';
                
            } catch (error) {
                showOutput('add-output', `‚ùå Error al agregar: ${error.message}`, true);
            }
        }

        // Agregar m√∫ltiples elementos
        async function addMultipleItems() {
            if (!isInitialized) {
                showOutput('add-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const sampleData = [
                { name: 'Ana Garc√≠a', email: 'ana@ejemplo.com', age: 25 },
                { name: 'Carlos L√≥pez', email: 'carlos@ejemplo.com', age: 35 },
                { name: 'Mar√≠a Rodr√≠guez', email: 'maria@ejemplo.com', age: 28 },
                { name: 'Pedro Mart√≠nez', email: 'pedro@ejemplo.com', age: 42 }
            ];
            
            try {
                for (const item of sampleData) {
                    item.createdAt = new Date().toISOString();
                    await dbManager.create(item);
                }
                showOutput('add-output', `‚úÖ ${sampleData.length} elementos agregados`);
            } catch (error) {
                showOutput('add-output', `‚ùå Error al agregar m√∫ltiples: ${error.message}`, true);
            }
        }

        // Buscar elementos
        async function searchItems() {
            if (!isInitialized) {
                showOutput('search-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const query = document.getElementById('search-input').value;
            
            try {
                const results = await dbManager.search({
                    query,
                    fields: ['name', 'email']
                });
                
                showOutput('search-output', `üîç Encontrados ${results.items.length} elementos:`);
                results.items.forEach(item => {
                    showOutput('search-output', `‚Ä¢ ID: ${item.id} - ${item.name} (${item.email})`);
                });
                
            } catch (error) {
                showOutput('search-output', `‚ùå Error en b√∫squeda: ${error.message}`, true);
            }
        }

        // Obtener todos los elementos
        async function getAllItems() {
            if (!isInitialized) {
                showOutput('search-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            try {
                const items = await dbManager.getAll();
                showOutput('search-output', `üìã Total de elementos: ${items.length}`);
                items.forEach(item => {
                    showOutput('search-output', `‚Ä¢ ID: ${item.id} - ${item.name} (${item.email}) - Edad: ${item.age}`);
                });
            } catch (error) {
                showOutput('search-output', `‚ùå Error al obtener elementos: ${error.message}`, true);
            }
        }

        // Obtener elementos paginados
        async function getPaginated() {
            if (!isInitialized) {
                showOutput('search-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const limit = parseInt(document.getElementById('limit-input').value) || 5;
            
            try {
                const results = await dbManager.search({
                    limit,
                    offset: 0
                });
                
                showOutput('search-output', `üìÑ P√°gina 1 (${results.items.length}/${results.total} elementos):`);
                results.items.forEach(item => {
                    showOutput('search-output', `‚Ä¢ ID: ${item.id} - ${item.name}`);
                });
                
            } catch (error) {
                showOutput('search-output', `‚ùå Error en paginaci√≥n: ${error.message}`, true);
            }
        }

        // Actualizar elemento
        async function updateItem() {
            if (!isInitialized) {
                showOutput('update-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const id = parseInt(document.getElementById('update-id').value);
            const name = document.getElementById('update-name').value;
            const email = document.getElementById('update-email').value;
            
            if (!id) {
                showOutput('update-output', '‚ö†Ô∏è Ingresa un ID v√°lido', true);
                return;
            }
            
            try {
                const updates = {};
                if (name) updates.name = name;
                if (email) updates.email = email;
                updates.updatedAt = new Date().toISOString();
                
                const result = await dbManager.update(id, updates);
                showOutput('update-output', `‚úÖ Elemento ${id} actualizado`);
                
                // Limpiar campos
                document.getElementById('update-id').value = '';
                document.getElementById('update-name').value = '';
                document.getElementById('update-email').value = '';
                
            } catch (error) {
                showOutput('update-output', `‚ùå Error al actualizar: ${error.message}`, true);
            }
        }

        // Eliminar por ID
        async function deleteItem() {
            if (!isInitialized) {
                showOutput('delete-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const id = parseInt(document.getElementById('delete-id').value);
            
            if (!id) {
                showOutput('delete-output', '‚ö†Ô∏è Ingresa un ID v√°lido', true);
                return;
            }
            
            try {
                await dbManager.delete(id);
                showOutput('delete-output', `‚úÖ Elemento ${id} eliminado`);
                document.getElementById('delete-id').value = '';
            } catch (error) {
                showOutput('delete-output', `‚ùå Error al eliminar: ${error.message}`, true);
            }
        }

        // Eliminar por email
        async function deleteByEmail() {
            if (!isInitialized) {
                showOutput('delete-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const email = document.getElementById('delete-email').value;
            
            if (!email) {
                showOutput('delete-output', '‚ö†Ô∏è Ingresa un email v√°lido', true);
                return;
            }
            
            try {
                const deleted = await dbManager.deleteWhere({ email });
                showOutput('delete-output', `‚úÖ ${deleted} elemento(s) eliminado(s) con email: ${email}`);
                document.getElementById('delete-email').value = '';
            } catch (error) {
                showOutput('delete-output', `‚ùå Error al eliminar por email: ${error.message}`, true);
            }
        }

        // Exportar datos
        async function exportData() {
            if (!isInitialized) {
                showOutput('export-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            try {
                const data = await dbManager.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'database-export.json';
                a.click();
                
                showOutput('export-output', '‚úÖ Datos exportados a JSON');
            } catch (error) {
                showOutput('export-output', `‚ùå Error al exportar: ${error.message}`, true);
            }
        }

        // Exportar a CSV
        async function exportCSV() {
            if (!isInitialized) {
                showOutput('export-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            try {
                const data = await dbManager.exportData({ format: 'csv' });
                const blob = new Blob([data], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'database-export.csv';
                a.click();
                
                showOutput('export-output', '‚úÖ Datos exportados a CSV');
            } catch (error) {
                showOutput('export-output', `‚ùå Error al exportar CSV: ${error.message}`, true);
            }
        }

        // Importar datos
        async function importData() {
            if (!isInitialized) {
                showOutput('export-output', '‚ö†Ô∏è Primero inicializa la base de datos', true);
                return;
            }
            
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showOutput('export-output', '‚ö†Ô∏è Selecciona un archivo JSON', true);
                return;
            }
            
            try {
                const text = await file.text();
                await dbManager.importData(text);
                showOutput('export-output', '‚úÖ Datos importados correctamente');
                fileInput.value = '';
            } catch (error) {
                showOutput('export-output', `‚ùå Error al importar: ${error.message}`, true);
            }
        }

        // Inicializar autom√°ticamente al cargar la p√°gina
        window.addEventListener('load', () => {
            showOutput('status-output', 'üöÄ Demo cargada. Presiona "Inicializar DB" para comenzar.');
        });
    </script>
</body>
</html>